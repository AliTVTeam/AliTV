<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset="utf-8">
<link rel="stylesheet" href="lib/jquery-ui-1.9.2.custom.min.css">
<link rel="stylesheet" href="css/AliTV.css">

<script src="lib/d3.v3.min.js"></script>
<script src="lib/jquery.min.js"></script>
<script src="lib/jquery-ui.min.js"></script>
<script src="lib/underscore.js"></script>

<script src="js/AliTV.js"></script>

<script type="text/javascript">
	var wga;
	$(document).ready(function() {
		var svg = $('#wgaCanvas');
		wga = new AliTV(svg);
		$.getJSON('data/data.json', function(data) {
			wga.setData(data);
			$.getJSON('data/filters.json', function(filters) {
				wga.setFilters(filters);
				wga.drawLinear();
			});
		});
		
		//Set default values for API of graphical parameters
		$("#linearSpacer").val(wga.getLinearSpacer());
		$("#karyoHeight").val(wga.getKaryoHeight());
		$("#canvasWidth").val(wga.getCanvasWidth());
		$("#canvasHeight").val(wga.getCanvasHeight());
		$("#tickDistance").val(wga.getTickDistance());
		
		$('#skipChromosomesWithoutVisibleLinks').attr('checked', false);
		$('#filterChromosomes').attr('checked', true);
		
		});
	
	$(function(){
		$("#identity-slider").slider({
			range: true,
			values: [0, 100],
			min: 0,
			max: 100,
			slide: function(event, ui){
				$("#identity-label").val(ui.values[0] + " % - " + ui.values[1] + " %");
				wga.filters.links.minLinkIdentity = ui.values[0];
				wga.filters.links.maxLinkIdentity = ui.values[1];
				var layout = wga.getLayout();
				wga.drawEqualLayout(layout);
			}
		});	
		$("#identity-label").val($("#identity-slider").slider("values", 0) + " % - " + $("#identity-slider").slider("values", 1) + " %");
		
		$("#length-slider").slider({
			range: true,
			values: [100, 1000],
			min: 100,
			max: 1000,
			slide: function(event, ui){
				$("#minlength-label").val(ui.values[0] + " bp - " + ui.values[1] + " bp");
				wga.filters.links.minLinkLength = ui.values[0];
				wga.filters.links.maxLinkLength = ui.values[1];
				var layout = wga.getLayout();
				wga.drawEqualLayout(layout);
				}
		});
		$("#minlength-label").val($("#length-slider").slider("values", 0) + " bp - " + $("#length-slider").slider("values", 1) + " bp");
	});
	
	$(function() {
		$( "#accordion" ).accordion();
	});
	
	$(function(){$('#skipChromosomesWithoutVisibleLinks').change(function() {
			if($('#skipChromosomesWithoutVisibleLinks').is(':checked')){
		     	wga.filters.skipChromosomesWithoutVisibleLinks = true;
			} else {
				wga.filters.skipChromosomesWithoutVisibleLinks = false;
			}
		});
	});
	
	$(function(){$('#showAllChromosomes').change(function() {
		if($('#showAllChromosomes').is(':checked')){
	     	wga.filters.showAllChromosomes = true;
		} else {
			wga.filters.showAllChromosomes = false;
		}
	});
});
	
	function changeLinearSpacer(){
		var spacer = $("#linearSpacer").val();
		try {
		wga.setLinearSpacer(spacer); 
		$("#linearSpacer").val(wga.getLinearSpacer());
		}
		catch(err){
			alert(err);
			$("#linearSpacer").val(wga.getLinearSpacer());
		}
	}
	function changeKaryoHeight(){
		var height = $("#karyoHeight").val(); 
		try {
		wga.setKaryoHeight(height); 	
		}
		catch(err){
			alert(err);
			$("#karyoHeight").val(wga.getKaryoHeight());
		}
	}
	function changeCanvasWidth(){
		var width = $("#canvasWidth").val(); 
		try {
		wga.setCanvasWidth(width); 	
		}
		catch(err){
			alert(err);
			$("#canvasWidth").val(wga.getCanvasWidth());
		}
	}
	function changeCanvasHeight(){
		var height = $("#canvasHeight").val(); 
		try {
		wga.setCanvasHeight(height); 
		}
		catch(err){
			alert(err);
			$("#canvasHeight").val(wga.getCanvasHeight());
		}
	}
	function changeTickDistance(){
		var distance = $("#tickDistance").val(); 
		try {
		wga.setTickDistance(distance); 	
		}
		catch(err){
			alert(err);
			$("#tickDistance").val(wga.getTickDistance());
		}
	}
	function setNewParameters(){
		changeLinearSpacer();
		changeKaryoHeight();
		changeCanvasWidth();
		changeCanvasHeight()
		changeTickDistance();
		
		var layout = wga.getLayout();
		wga.drawEqualLayout(layout);
	}
</script>
</head>
<body>

<div style="width: 100%; overflow: hidden;">
 	<div id="accordion" class="form-style-5" style="float:left">
 		<h3><span class="number">1</span> Choose your layout</h3>
 		<div>
 			<button type="submit" onclick="wga.drawCircular();">Draw Circular</button> 
 			<button type="submit" onclick="wga.drawLinear();">Draw Linear</button> 
 		</div>
 		<h3><span class="number">2</span> Change graphical parameters</h3>
 		<div>
 			<form>
 				<fieldset>
 					Spacer between chromsomes:<br>
 					<input type="text" id="linearSpacer" placeholder="Enter a spacer">
 					<br>
 					Height of chromosomes:<br>
 					<input type="text" id="karyoHeight" placeholder="Enter a height">
 					<br>
 					Width:<br>
 					<input type="text" id="canvasWidth" placeholder="Enter the svg-width">
 					<br>
 					Height:<br>
 					<input type="text" id="canvasHeight" placeholder="Enter the svg-height">
 					<br>
 					Distance between ticks:<br>
 					<input type="text" id="tickDistance" placeholder="Enter the distance between ticks">
 					<br>
 				</fieldset>
 			</form>
 		</div>
 		<h3><span class="number">3</span> Filtering</h3>
 		<div>
 			<form>
 				<fieldset>
 					Filter link identity:
 					<p>
 						<label for="identity-label">Identity range:</label> 
 						<input type="text"id="identity-label" readonly>
 					</p>
 					<div id="identity-slider"></div>
 					<br>
 					Filter link length for drawn links:<br>
					<p>
						<label for="minlength-label">Length range:</label>
						<input type="text" id="minlength-label" readonly>
					</p>
 					<div id="length-slider"></div>
 					<br>
 					Skip chromosomes without visible links: <input id="skipChromosomesWithoutVisibleLinks" type="checkbox">
 					<br>
 					<br>
 					Show all chromosomes: <input id="showAllChromosomes" type="checkbox">
 				</fieldset>
 			</form> 
 		</div>
		<button type="submit" onclick="setNewParameters()">Apply</button>		
 	</div>
 	<svg id='wgaCanvas' style="margin:50px"></svg>
 </div>
 
 </body>
 </html>



