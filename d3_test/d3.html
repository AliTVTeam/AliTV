<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="css/jquery-ui.min.css">
<style type="text/css">
body {
	font: 10px sans-serif;
}

.chord path {
	fill-opacity: .67;
}


.tooltip {
	border: solid 1px #aaa;
  	border-radius: 8px;
  	padding: 8px;
	background: #ddd;
	color: #000000;
	outline: none;
	text-decoration: none;
	position: absolute;
	font: 12px sans-serif;
}

.legend {
	font: 12px sans-serif;
}
rect {
	stroke-width: 2;
}

                                                       
</style>
<script src="js/d3.v3.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/jquery-ui.min.js"></script>

</head>

<body>
	<!--<script src="js/wgaPipeline_circular.js"></script>-->
	<script src="js/wgaPipeline_circular_loadStuff.js"></script>
	<script src="js/wgaPipeline_circular_karyoStuff.js"></script>
	<script src="js/wgaPipeline_circular_linkStuff.js"></script>
	<script src="js/wgaPipeline_circular_generalDrawingInformation.js"></script>
	
	<script>

		var identity_range = [75,100];
		var min_length = 1000;	
	
		$(function() {
			$("#identity-slider").slider({
				range : true,
				min : 0,
				max : 100,
				values : [ 75, 100 ],
				slide : function(event, ui) {
						$("#identity-label").val(ui.values[0] + " % - " + ui.values[1] + " %");
						identity_range = [ui.values[0],ui.values[1]];
						redraw(identity_range, min_length);
				}
			});
			$("#identity-label").val(
					$("#identity-slider").slider("values", 0) + " % - "
							+ $("#identity-slider").slider("values", 1) + " %");
			$("#minlength-slider").slider({
				range : false,
				min : 10,
				max : 100,
				step: 100,
				value : 1000,
				slide : function(event, ui) {
						$("#minlength-label").val(ui.value + " bp");
						min_length = ui.value;
						redraw(identity_range, min_length);
				}
			});
			$("#minlength-label").val(
					$("#minlength-slider").slider("value") + " bp");
			
			var max = $( "#minlength-slider" ).slider( "option", "max" );
			$( "#minlength-slider" ).slider( "option", "max", set_slider());
		});
		
		var full_karyo;
		var full_links;
		loadKaryoFile("data/karyo.json", function(karyo) {
			//var max = $( "#minlength-slider" ).slider( "option", "max" );
			//$( "#minlength-slider" ).slider( "option", "max", set_slider());
			full_karyo = karyo;
			drawKaryo(karyo);
			loadLinkFile("data/link.json", karyo, function(links) {
				full_links = links;
				redraw(identity_range, min_length);
			});
			
		});
		

		function redraw(identity_range,min_length) {
			clear_chords();
			var links = filter_links_by_length(full_links, min_length);
			links = filter_links_by_identity(links, identity_range);
			drawLinks(links);
		}

		function filter_links_by_length(links, minlen) {
			var filtered = new Array();
			$.each(links, function(index, value) {
				var len = Math.abs(value.source.start - value.source.end);
				if (len >= minlen) {
					filtered.push(value);
				}
			});
			return filtered;
		}
		
		function filter_links_by_identity(links, identity_range) {
			var filtered = new Array();
			$.each(links, function(index, value) {
				if (value.identity >= identity_range[0] && value.identity <= identity_range[1]) {
					filtered.push(value);
				}
			});
			return filtered;
		}
		
		
	</script>
	<p>
		<label for="identity-label">Identity range:</label> <input type="text"
			id="identity-label" readonly
			style="border: 0; color: #f6931f; font-weight: bold;">
	</p>
	<div id="identity-slider"></div>
	<p>
		<label for="minlength-label">Min. length:</label> <input type="text"
			id="minlength-label" readonly
			style="border: 0; color: #f6931f; font-weight: bold;">
	</p>
	<div id="minlength-slider"></div>
</body>
</html>
